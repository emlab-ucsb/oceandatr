<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="description" content="oceandatr">
<title>Pacific High Seas Example • oceandatr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- bootstrap-toc --><script src="https://cdn.jsdelivr.net/gh/afeld/bootstrap-toc@v1.0.1/dist/bootstrap-toc.min.js" integrity="sha256-4veVQbu7//Lk5TSmc7YV48MxtMy98e26cf5MrgZYnwo=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pacific High Seas Example">
<meta property="og:description" content="oceandatr">
<meta property="og:image" content="https://emlab-ucsb.github.io/oceandatr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">oceandatr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.1.0</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
<li class="active nav-item dropdown">
  <a href="#" class="nav-link dropdown-toggle" data-bs-toggle="dropdown" role="button" aria-expanded="false" aria-haspopup="true" id="dropdown-articles">Articles</a>
  <div class="dropdown-menu" aria-labelledby="dropdown-articles">
    <a class="dropdown-item" href="../articles/getarea_vignette.html">Selecting areas with oceandatr</a>
    <a class="dropdown-item" href="../articles/pacific_high_seas_example.html">Pacific High Seas Example</a>
  </div>
</li>
      </ul>
<form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off">
</form>

      <ul class="navbar-nav"></ul>
</div>

    
  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Pacific High Seas Example</h1>
            
      
      
      <div class="d-none name"><code>pacific_high_seas_example.Rmd</code></div>
    </div>

    
    
<p>Along with <code>oceandatr</code> we will need to load
<code>prioritizr</code> for the spatial prioritization and we will use
the open source solver <code>lsymphony</code> to solve the
prioritization problem, so this needs to be installed and loaded via th
Bioconductor website</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emlab-ucsb.github.io/oceandatr/">oceandatr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gfwr</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://prioritizr.net" class="external-link">prioritizr</a></span><span class="op">)</span></span>
<span><span class="co">#remotes::install_bioc("lpsymphony")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">lpsymphony</span><span class="op">)</span></span>
<span><span class="co">#remotes::install_github("emlab-ucsb/patchwise")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">patchwise</span><span class="op">)</span></span></code></pre></div>
<p>This example shows how to use <code>oceandatr</code> to create a
complete set of feature data that can be used directly in a spatial
prioritization.</p>
<div class="section level2">
<h2 id="high-seas-area-of-the-pacific-ocean">High Seas area of the Pacific Ocean<a class="anchor" aria-label="anchor" href="#high-seas-area-of-the-pacific-ocean"></a>
</h2>
<p>First we retrieve the entire High Seas area, then we will crop for
the area we are interested in, highlighted in red on the map.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_area.html">get_area</a></span><span class="op">(</span>area_name <span class="op">=</span> <span class="st">"63203"</span>, query_type <span class="op">=</span> <span class="st">"high_seas"</span>, mregions_column <span class="op">=</span> <span class="st">"mrgid"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pacific_hs_area_extent</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="fl">135</span>, xmax <span class="op">=</span> <span class="fl">155</span>, ymin <span class="op">=</span> <span class="fl">0</span>, ymax <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">hs</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"High Seas"</span>, col <span class="op">=</span> <span class="st">"royalblue3"</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pacific_hs_area_extent</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span>to <span class="op">=</span> <span class="st">"LINESTRING"</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/high_seas_area-1.png" alt=""><p class="caption">plot of chunk high_seas_area</p>
</div>
<p>We are going to use only the highlighted Pacific High Seas area which
borders Indonesia, Papua New Guinea, Palau and the Federated States of
Micronesia. We can get the EEZs of these states using
<code>oceandatr</code>’s <code>get_area</code> function.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">country_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Indonesia"</span>, <span class="st">"Papua New Guinea"</span>, <span class="st">"Palau"</span>, <span class="st">"Micronesia"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">eezs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">country_names</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="../reference/get_area.html">get_area</a></span><span class="op">(</span>area_name <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">territory1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">territory1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span>to <span class="op">=</span> <span class="st">"MULTIPOLYGON"</span><span class="op">)</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html" class="external-link">sf_use_s2</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co">#turn off S2 to avoid errors</span></span>
<span></span>
<span><span class="va">pacific_hs</span> <span class="op">&lt;-</span> <span class="va">hs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span><span class="va">pacific_hs_area_extent</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Pacific High Seas area"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html" class="external-link">sf_use_s2</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="va">pacific_hs</span>, to <span class="op">=</span> <span class="st">"MULTIPOLYGON"</span><span class="op">)</span>, <span class="va">eezs</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, las <span class="op">=</span> <span class="fl">1</span>, main <span class="op">=</span> <span class="cn">NULL</span>, key.pos <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/pacific_high_seas-1.png" alt=""><p class="caption">plot of chunk pacific_high_seas</p>
</div>
<p>Now we select a suitable projection for the area and a suitable
resolution for the planning grid used for gridding the data. We can use
<a href="https://projectionwizard.org" class="external-link">projection wizard</a> to find an
equal-area projection, entering the same extent coordinates we used to
crop the high seas area (xmin = 135, xmax = 155, ymin = 0, ymax =
6).</p>
<p>We will use 10km square planning units so that there the data
processing and prioritization run reasonably fast (smaller planning
units will require more time/ computer memory get data for)</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pacific_hs_projection</span> <span class="op">&lt;-</span> <span class="st">"+proj=cea +lon_0=145 +lat_ts=3 +datum=WGS84 +units=m +no_defs"</span></span>
<span></span>
<span><span class="va">pacific_hs_planning_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://emlab-ucsb.github.io/spatialgridr/reference/get_grid.html" class="external-link">get_grid</a></span><span class="op">(</span>area_polygon <span class="op">=</span> <span class="va">pacific_hs</span>,</span>
<span>                                   projection_crs <span class="op">=</span> <span class="va">pacific_hs_projection</span>,</span>
<span>                                   resolution <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#get_grid returns a raster by default, so we can plot it using the terra package</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pacific_hs_planning_grid</span>, col <span class="op">=</span> <span class="st">"grey70"</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/planning_grid-1.png" alt=""><p class="caption">plot of chunk planning_grid</p>
</div>
<p>Now we have a planning grid, we can use get a basic set of features
to use in a spatial prioritization with a single command, setting the
seamount buffer to 30km:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feature_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_features.html">get_features</a></span><span class="op">(</span>spatial_grid <span class="op">=</span> <span class="va">pacific_hs_planning_grid</span>, seamount_buffer <span class="op">=</span> <span class="fl">30000</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">feature_set</span>, maxnl <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">feature_set</span><span class="op">)</span>, fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pacific_hs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">pacific_hs_projection</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">#set maximum number of layers to plot to the same as the number of layers in the feature set</span></span></code></pre></div>
<div class="figure">
<img src="figure/features-1.png" alt=""><p class="caption">plot of chunk features</p>
</div>
</div>
<div class="section level2">
<h2 id="cost-data-fishing-effort">Cost data: fishing effort<a class="anchor" aria-label="anchor" href="#cost-data-fishing-effort"></a>
</h2>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pacific_hs_geojson</span> <span class="op">&lt;-</span> <span class="va">pacific_hs_area_extent</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">#use the larger area extent because using just the pacific_hs polygon results in a slightly truncated area</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">gfwr</span><span class="fu">::</span><span class="fu">sf_to_geojson</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fishing_effort</span> <span class="op">&lt;-</span> <span class="fu">gfwr</span><span class="fu">::</span><span class="fu">get_raster</span><span class="op">(</span>spatial_resolution <span class="op">=</span> <span class="st">'low'</span>,</span>
<span>                                   temporal_resolution <span class="op">=</span> <span class="st">'yearly'</span>,</span>
<span>                                   group_by <span class="op">=</span> <span class="st">'gearType'</span>, </span>
<span>                                   date_range <span class="op">=</span> <span class="st">'2022-01-01,2022-12-31'</span>,</span>
<span>                                   region <span class="op">=</span> <span class="va">pacific_hs_geojson</span>,</span>
<span>                                   region_source <span class="op">=</span> <span class="st">'user_json'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">total_annual_effort</span> <span class="op">&lt;-</span> <span class="va">fishing_effort</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Lat</span>, <span class="va">Lon</span>, <span class="va">`Time Range`</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total_effort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">`Apparent Fishing Hours`</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"Lon"</span>, <span class="st">"Lat"</span>, <span class="st">"total_effort"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"xyz"</span>, crs <span class="op">=</span> <span class="st">"epsg:4326"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/subst.html" class="external-link">subst</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://emlab-ucsb.github.io/spatialgridr/reference/get_data_in_grid.html" class="external-link">get_data_in_grid</a></span><span class="op">(</span>spatial_grid <span class="op">=</span> <span class="va">pacific_hs_planning_grid</span>,</span>
<span>                                   dat <span class="op">=</span> <span class="va">.</span>,</span>
<span>                                   name <span class="op">=</span> <span class="st">"fishing_effort"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">total_annual_effort</span>, fun <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pacific_hs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">pacific_hs_projection</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/fishing-effort-1.png" alt=""><p class="caption">plot of chunk fishing-effort</p>
</div>
</div>
<div class="section level2">
<h2 id="run-a-simple-prioritization">Run a simple prioritization<a class="anchor" aria-label="anchor" href="#run-a-simple-prioritization"></a>
</h2>
<p>Set targets of 20% for all features.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu">prioritizr</span><span class="fu">::</span><span class="fu">problem</span><span class="op">(</span>x <span class="op">=</span> <span class="va">total_annual_effort</span>, features <span class="op">=</span> <span class="va">feature_set</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">add_min_set_objective</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">add_relative_targets</span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">#add_boundary_penalties(penalty = 0.0001) %&gt;% </span></span>
<span>  <span class="fu">add_binary_decisions</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">add_lpsymphony_solver</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span>, main <span class="op">=</span> <span class="st">"Solution"</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey70"</span>, <span class="st">"green4"</span><span class="op">)</span>,</span>
<span>            type <span class="op">=</span> <span class="st">"classes"</span>,</span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Not selected"</span>, <span class="st">"Selected"</span><span class="op">)</span>,</span>
<span>            fun <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pacific_hs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">pacific_hs_projection</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/prioritization-1.png" alt=""><p class="caption">plot of chunk prioritization</p>
</div>
</div>
<div class="section level2">
<h2 id="prioritization-with-patches">Prioritization with patches<a class="anchor" aria-label="anchor" href="#prioritization-with-patches"></a>
</h2>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Separate seamount data - we want to protect entire patches</span></span>
<span><span class="va">seamounts_rast</span> <span class="op">&lt;-</span> <span class="va">feature_set</span><span class="op">[[</span><span class="st">"seamounts"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">features_rast</span> <span class="op">&lt;-</span> <span class="va">feature_set</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">feature_set</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">feature_set</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"seamounts"</span><span class="op">]</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create seamount patches - seamount areas that touch are considered the same patch</span></span>
<span><span class="va">patches_rast</span> <span class="op">&lt;-</span> <span class="fu">patchwise</span><span class="fu">::</span><span class="fu">create_patches</span><span class="op">(</span><span class="va">seamounts_rast</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create patches dataframe - this creates several constraints so that entire seamount units are protected together</span></span>
<span><span class="va">patches_df_rast</span> <span class="op">&lt;-</span> <span class="fu">patchwise</span><span class="fu">::</span><span class="fu">create_patch_df</span><span class="op">(</span>planning_grid <span class="op">=</span> <span class="va">pacific_hs_planning_grid</span>, features <span class="op">=</span> <span class="va">features_rast</span>, patches <span class="op">=</span> <span class="va">patches_rast</span>, costs <span class="op">=</span> <span class="va">total_annual_effort</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Processing patch 1 of 6"</span></span>
<span><span class="co">#&gt; [1] "Processing patch 2 of 6"</span></span>
<span><span class="co">#&gt; [1] "Processing patch 3 of 6"</span></span>
<span><span class="co">#&gt; [1] "Processing patch 4 of 6"</span></span>
<span><span class="co">#&gt; [1] "Processing patch 5 of 6"</span></span>
<span><span class="co">#&gt; [1] "Processing patch 6 of 6"</span></span>
<span></span>
<span><span class="co"># Create boundary matrix for prioritizr</span></span>
<span><span class="va">boundary_matrix_rast</span> <span class="op">&lt;-</span> <span class="fu">patchwise</span><span class="fu">::</span><span class="fu">create_boundary_matrix</span><span class="op">(</span>planning_grid <span class="op">=</span> <span class="va">pacific_hs_planning_grid</span>, patches <span class="op">=</span> <span class="va">patches_rast</span>, patch_df <span class="op">=</span> <span class="va">patches_df_rast</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create targets for protection - let's just do 20% for each feature (including 20% of whole seamounts)</span></span>
<span><span class="va">targets_rast</span> <span class="op">&lt;-</span> <span class="fu">patchwise</span><span class="fu">::</span><span class="fu">features_targets</span><span class="op">(</span>targets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">features_rast</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, features <span class="op">=</span> <span class="va">features_rast</span>, pre_patches <span class="op">=</span> <span class="va">seamounts_rast</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add these targets to targets for protection for the "constraints" we introduced to protect entire seamount units</span></span>
<span><span class="va">constraints_rast</span> <span class="op">&lt;-</span> <span class="fu">patchwise</span><span class="fu">::</span><span class="fu">constraints_targets</span><span class="op">(</span>feature_targets <span class="op">=</span> <span class="va">targets_rast</span>, patch_df <span class="op">=</span> <span class="va">patches_df_rast</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the prioritization</span></span>
<span><span class="va">problem_rast</span> <span class="op">&lt;-</span> <span class="fu">prioritizr</span><span class="fu">::</span><span class="fu">problem</span><span class="op">(</span>x <span class="op">=</span> <span class="va">patches_df_rast</span>, features <span class="op">=</span> <span class="va">constraints_rast</span><span class="op">$</span><span class="va">feature</span>, cost_column <span class="op">=</span> <span class="st">"fishing_effort"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">prioritizr</span><span class="fu">::</span><span class="fu">add_min_set_objective</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">prioritizr</span><span class="fu">::</span><span class="fu">add_manual_targets</span><span class="op">(</span><span class="va">constraints_rast</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">prioritizr</span><span class="fu">::</span><span class="fu">add_binary_decisions</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">#prioritizr::add_boundary_penalties(penalty = 0.0001, data = boundary_matrix_rast) %&gt;%</span></span>
<span>  <span class="fu">prioritizr</span><span class="fu">::</span><span class="fu">add_lpsymphony_solver</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Solve the prioritization</span></span>
<span><span class="va">solution_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">problem_rast</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert the prioritization into a more digestible format</span></span>
<span><span class="va">result_rast</span> <span class="op">&lt;-</span> <span class="fu">patchwise</span><span class="fu">::</span><span class="fu">convert_solution</span><span class="op">(</span>solution <span class="op">=</span> <span class="va">solution_rast</span>, patch_df <span class="op">=</span> <span class="va">patches_df_rast</span>, planning_grid <span class="op">=</span> <span class="va">pacific_hs_planning_grid</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show the results</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result_rast</span>, main <span class="op">=</span> <span class="st">"Solution"</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, </span>
<span>            col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey70"</span>, <span class="st">"green4"</span><span class="op">)</span>,</span>
<span>            type <span class="op">=</span> <span class="st">"classes"</span>,</span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Not selected"</span>, <span class="st">"Selected"</span><span class="op">)</span>,</span>
<span>            fun <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pacific_hs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">pacific_hs_projection</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<div class="figure">
<img src="figure/prioritization_patches-1.png" alt=""><p class="caption">plot of chunk prioritization_patches</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p></p>
<p>Developed by Jason Flower.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

    </footer>
</div>

  

  

  </body>
</html>
