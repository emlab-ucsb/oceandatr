<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Pacific High Seas Example • oceandatr</title>
<script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Pacific High Seas Example">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">oceandatr</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/getboundary.html">Retrieving boundaries with get_boundary()</a></li>
    <li><a class="dropdown-item" href="../articles/pacific_high_seas_example.html">Pacific High Seas Example</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="../logo.png" class="logo" alt=""><h1>Pacific High Seas Example</h1>
            
      

      <div class="d-none name"><code>pacific_high_seas_example.Rmd</code></div>
    </div>

    
    
<p>This example walks though how to do a spatial prioritization using
<code>oceandatr</code> to obtain suitable data, and also using the
package <a href="https://github.com/emlab-ucsb/patchwise" class="external-link"><code>patchwise</code></a>
to ensure that entire seamounts are included in the prioritization
solutions.</p>
<p>We use a High Seas area of the Pacific as the planning area for this
example since it is outside any states’ jurisdiction.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co">#load oceandatr package</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://emlab-ucsb.github.io/oceandatr/">oceandatr</a></span><span class="op">)</span></span></code></pre></div>
<p>Along with <code>oceandatr</code> we will need to load
<code>prioritizr</code> for the spatial prioritization and we will use
the open source solver <code>lsymphony</code> to solve the
prioritization problem, so this needs to be installed and loaded via th
Bioconductor website</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">gfwr</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://prioritizr.net" class="external-link">prioritizr</a></span><span class="op">)</span></span>
<span><span class="co">#remotes::install_bioc("lpsymphony")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">lpsymphony</span><span class="op">)</span></span>
<span><span class="co">#remotes::install_github("emlab-ucsb/patchwise")</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">patchwise</span><span class="op">)</span></span></code></pre></div>
<div class="section level2">
<h2 id="high-seas-area-of-the-pacific-ocean">High Seas area of the Pacific Ocean<a class="anchor" aria-label="anchor" href="#high-seas-area-of-the-pacific-ocean"></a>
</h2>
<p>First we retrieve geospatial data for the North Pacific Ocean using
<code><a href="https://emlab-ucsb.github.io/spatialgridr/reference/get_boundary.html" class="external-link">get_boundary()</a></code>, then we will crop for the area we are
interested in, highlighted in red on the map.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">high_seas</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://emlab-ucsb.github.io/spatialgridr/reference/get_boundary.html" class="external-link">get_boundary</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"high_seas"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">pacific_hs_area_extent</span> <span class="op">&lt;-</span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_bbox.html" class="external-link">st_bbox</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span>xmin <span class="op">=</span> <span class="fl">135</span>, xmax <span class="op">=</span> <span class="fl">155</span>, ymin <span class="op">=</span> <span class="fl">0</span>, ymax <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>, crs <span class="op">=</span> <span class="fl">4326</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_geometry.html" class="external-link">st_geometry</a></span><span class="op">(</span><span class="va">high_seas</span><span class="op">)</span>, main <span class="op">=</span> <span class="st">"High Seas"</span>, col <span class="op">=</span> <span class="st">"royalblue3"</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, las <span class="op">=</span> <span class="fl">1</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pacific_hs_area_extent</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span>to <span class="op">=</span> <span class="st">"LINESTRING"</span><span class="op">)</span>, col <span class="op">=</span> <span class="st">"red"</span>, lwd<span class="op">=</span><span class="fl">2</span>, add <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure/high_seas_area-1.png" alt="Map of the High Seas"><p class="caption">
Map of the High Seas
</p>
</div>
<p>We are going to use only the highlighted Pacific area which borders
Indonesia, Papua New Guinea, Palau and the Federated States of
Micronesia. We can get the EEZs of these states using
<code>oceandatr</code>’s <code>get_area</code> function.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">country_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Indonesia"</span>, <span class="st">"Papua New Guinea"</span>, <span class="st">"Palau"</span>, <span class="st">"Micronesia"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">eezs</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/lapply.html" class="external-link">lapply</a></span><span class="op">(</span><span class="va">country_names</span>, FUN <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span> <span class="fu"><a href="https://emlab-ucsb.github.io/spatialgridr/reference/get_boundary.html" class="external-link">get_boundary</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">x</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">territory1</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/rename.html" class="external-link">rename</a></span><span class="op">(</span>name <span class="op">=</span> <span class="va">territory1</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://rdrr.io/r/base/do.call.html" class="external-link">do.call</a></span><span class="op">(</span><span class="va">rbind</span>, <span class="va">.</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span>to <span class="op">=</span> <span class="st">"MULTIPOLYGON"</span><span class="op">)</span></span></code></pre></div>
<p>We only want the high sea portion of the area outlined above. We can
now create a polygon of this by remove the bordering states EEZs.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html" class="external-link">sf_use_s2</a></span><span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="co">#turn off S2 to avoid errors</span></span>
<span></span>
<span><span class="va">pacific_hs</span> <span class="op">&lt;-</span> <span class="va">high_seas</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_crop.html" class="external-link">st_crop</a></span><span class="op">(</span><span class="va">pacific_hs_area_extent</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/sf.html" class="external-link">st_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Pacific High Seas area"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">name</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/s2.html" class="external-link">sf_use_s2</a></span><span class="op">(</span><span class="cn">TRUE</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/cbind.html" class="external-link">rbind</a></span><span class="op">(</span><span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_cast.html" class="external-link">st_cast</a></span><span class="op">(</span><span class="va">pacific_hs</span>, to <span class="op">=</span> <span class="st">"MULTIPOLYGON"</span><span class="op">)</span>, <span class="va">eezs</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">TRUE</span>, main <span class="op">=</span> <span class="cn">NULL</span>, key.pos <span class="op">=</span> <span class="fl">4</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure/pacific_high_seas-1.png" alt="Map of Pacific High Seas area in regional context"><p class="caption">
Map of Pacific High Seas area in regional context
</p>
</div>
<p>Now we select a suitable projection for the area and a suitable
resolution for the planning grid used for gridding the data. We can use
<a href="https://projectionwizard.org" class="external-link">projection wizard</a> to find an
equal-area projection, entering the same extent coordinates we used to
crop the high seas area (xmin = 135, xmax = 155, ymin = 0, ymax =
6).</p>
<p>We will use 10km square planning units so that there the data
processing and prioritization run reasonably fast (smaller planning
units will require more time/ computer memory get data for)</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="va">pacific_hs_projection</span> <span class="op">&lt;-</span> <span class="st">"+proj=cea +lon_0=145 +lat_ts=3 +datum=WGS84 +units=m +no_defs"</span></span>
<span></span>
<span><span class="va">pacific_hs_planning_grid</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://emlab-ucsb.github.io/spatialgridr/reference/get_grid.html" class="external-link">get_grid</a></span><span class="op">(</span>boundary <span class="op">=</span> <span class="va">pacific_hs</span>,</span>
<span>                                     crs <span class="op">=</span> <span class="va">pacific_hs_projection</span>,</span>
<span>                                     resolution <span class="op">=</span> <span class="fl">10000</span><span class="op">)</span> </span>
<span></span>
<span><span class="co">#get_grid returns a raster by default, so we can plot it using the terra package</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pacific_hs_planning_grid</span>, col <span class="op">=</span> <span class="st">"grey70"</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure/planning_grid-1.png" alt="Pacific High Seas area planning grid raster"><p class="caption">
Pacific High Seas area planning grid raster
</p>
</div>
<p>Now we have a planning grid, we can get data on conservation features
(e.g. habitats) using <code>oceandatr</code> to use in a spatial
prioritization with a single command <code><a href="../reference/get_features.html">get_features()</a></code>. We
have to set the seamount buffer, which is the area around the seamount
that is included as part of the seamount, and we use 30km based since
biodiversity is known to be higher within this distance of seamount
peaks (see <code>?get_seamounts_buffered</code> for more info).</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">feature_set</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/get_features.html">get_features</a></span><span class="op">(</span>spatial_grid <span class="op">=</span> <span class="va">pacific_hs_planning_grid</span>, seamount_buffer <span class="op">=</span> <span class="fl">30000</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">remove_empty_layers</span><span class="op">(</span><span class="op">)</span> <span class="co">#use this to remove raster layers that are empty</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">feature_set</span>, </span>
<span>            col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey60"</span>, <span class="st">"royalblue"</span><span class="op">)</span>, </span>
<span>            maxnl <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">feature_set</span><span class="op">)</span>,</span>
<span>            axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            fun <span class="op">=</span> <span class="kw">function</span><span class="op">(</span><span class="va">x</span><span class="op">)</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pacific_hs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">pacific_hs_projection</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="co">#set maximum number of layers to plot to the same as the number of layers in the feature set</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure/features-1.png" alt="Conservation features for the Pacific High Seas planning area"><p class="caption">
Conservation features for the Pacific High Seas planning area
</p>
</div>
</div>
<div class="section level2">
<h2 id="cost-data-global-fishing-watch-data">Cost data: Global Fishing Watch data<a class="anchor" aria-label="anchor" href="#cost-data-global-fishing-watch-data"></a>
</h2>
<p>The other piece of data needed for a spatial prioritization is cost.
In terrestrial spatial planning, this can be the actually monetary value
of buying the land for conservation. In marine spatial planning,
measures of fishing, such as catch and fishing effort, are often used as
the opportunity cost for each planning unit.</p>
<p><a href="https://globalfishingwatch.org/" class="external-link">Global Fishing Watch</a>
has global fishing effort data, and this can be accessed easily using
the R package <a href="https://github.com/GlobalFishingWatch/gfwr" class="external-link"><code>gfwr</code></a>.
An API key is required, but can be easily generated at no cost; see the
<code>gfwr</code> website for more details.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pacific_hs_geojson</span> <span class="op">&lt;-</span> <span class="va">pacific_hs_area_extent</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="co">#use the larger area extent because using just the pacific_hs polygon results in a slightly truncated area</span></span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sfc.html" class="external-link">st_as_sfc</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_as_sf.html" class="external-link">st_as_sf</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">gfwr</span><span class="fu">::</span><span class="fu">sf_to_geojson</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="va">fishing_effort</span> <span class="op">&lt;-</span> <span class="fu">gfwr</span><span class="fu">::</span><span class="fu">get_raster</span><span class="op">(</span>spatial_resolution <span class="op">=</span> <span class="st">'low'</span>,</span>
<span>                                   temporal_resolution <span class="op">=</span> <span class="st">'yearly'</span>,</span>
<span>                                   group_by <span class="op">=</span> <span class="st">'gearType'</span>, </span>
<span>                                   date_range <span class="op">=</span> <span class="st">'2022-01-01,2022-12-31'</span>,</span>
<span>                                   region <span class="op">=</span> <span class="va">pacific_hs_geojson</span>,</span>
<span>                                   region_source <span class="op">=</span> <span class="st">'user_json'</span><span class="op">)</span></span>
<span></span>
<span><span class="va">total_annual_effort</span> <span class="op">&lt;-</span> <span class="va">fishing_effort</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">Lat</span>, <span class="va">Lon</span>, <span class="va">`Time Range`</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarise</a></span><span class="op">(</span>total_effort <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">`Apparent Fishing Hours`</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">ungroup</a></span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="st">"Lon"</span>, <span class="st">"Lat"</span>, <span class="st">"total_effort"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/rast.html" class="external-link">rast</a></span><span class="op">(</span>type <span class="op">=</span> <span class="st">"xyz"</span>, crs <span class="op">=</span> <span class="st">"epsg:4326"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/subst.html" class="external-link">subst</a></span><span class="op">(</span><span class="cn">NA</span>, <span class="fl">0.01</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://emlab-ucsb.github.io/spatialgridr/reference/get_data_in_grid.html" class="external-link">get_data_in_grid</a></span><span class="op">(</span>spatial_grid <span class="op">=</span> <span class="va">pacific_hs_planning_grid</span>,</span>
<span>                                   dat <span class="op">=</span> <span class="va">.</span>,</span>
<span>                                   name <span class="op">=</span> <span class="st">"fishing_effort"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">total_annual_effort</span>, fun <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pacific_hs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">pacific_hs_projection</span><span class="op">)</span><span class="op">)</span>, axes <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure/fishing-effort-1.png" alt="Map of total apparent fishing effort in 2022 for the Pacific High Seas area. Data from Global Fishing Watch"><p class="caption">
Map of total apparent fishing effort in 2022 for the Pacific High Seas
area. Data from Global Fishing Watch
</p>
</div>
</div>
<div class="section level2">
<h2 id="run-a-simple-spatial-prioritization">Run a simple spatial prioritization<a class="anchor" aria-label="anchor" href="#run-a-simple-spatial-prioritization"></a>
</h2>
<p>We now have all the data we need to create a conservation problem and
solve it to get a map of priority areas for conservation for our Pacific
High Seas area. For the prioritization, we need to set targets for how
much of each conservation feature must be included in the prioritized
areas. We will set this at 20%.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">prob</span> <span class="op">&lt;-</span> <span class="fu">prioritizr</span><span class="fu">::</span><span class="fu">problem</span><span class="op">(</span>x <span class="op">=</span> <span class="va">total_annual_effort</span>, features <span class="op">=</span> <span class="va">feature_set</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">add_min_set_objective</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">add_relative_targets</span><span class="op">(</span><span class="fl">0.2</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="co">#add_boundary_penalties(penalty = 0.00001) %&gt;% </span></span>
<span>  <span class="fu">add_binary_decisions</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> </span>
<span>  <span class="fu">add_lpsymphony_solver</span><span class="op">(</span>verbose <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span></span>
<span><span class="va">sol</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">prob</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">sol</span>, main <span class="op">=</span> <span class="st">"Solution"</span>,  </span>
<span>            col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey70"</span>, <span class="st">"green4"</span><span class="op">)</span>,</span>
<span>            type <span class="op">=</span> <span class="st">"classes"</span>,</span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Not selected"</span>, <span class="st">"Selected"</span><span class="op">)</span>,</span>
<span>            fun <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pacific_hs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">pacific_hs_projection</span><span class="op">)</span><span class="op">)</span>,</span>
<span>            axes <span class="op">=</span> <span class="cn">FALSE</span>, </span>
<span>            mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">6</span><span class="op">)</span><span class="op">+</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.polygons.html" class="external-link">as.polygons</a></span><span class="op">(</span><span class="va">feature_set</span><span class="op">[[</span><span class="st">"seamounts"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure/prioritization-1.png" alt="Prioritization solution for the Pacific High Seas area. Black outlines are seamounts."><p class="caption">
Prioritization solution for the Pacific High Seas area. Black outlines
are seamounts.
</p>
</div>
</div>
<div class="section level2">
<h2 id="prioritization-with-patches">Prioritization with patches<a class="anchor" aria-label="anchor" href="#prioritization-with-patches"></a>
</h2>
<p>To ensure that whole seamount areas area included in the solution, we
need to use the <code>patchwise</code> package to do some pre-processing
of the data we use. The prioritization result is similar to that above,
but whole seamount patches equal to at least 20% of the total seamount
area are included.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Separate seamount data - we want to protect entire patches</span></span>
<span><span class="va">seamounts_rast</span> <span class="op">&lt;-</span> <span class="va">feature_set</span><span class="op">[[</span><span class="st">"seamounts"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="va">features_rast</span> <span class="op">&lt;-</span> <span class="va">feature_set</span><span class="op">[[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">feature_set</span><span class="op">)</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/names.html" class="external-link">names</a></span><span class="op">(</span><span class="va">feature_set</span><span class="op">)</span> <span class="op">!=</span> <span class="st">"seamounts"</span><span class="op">]</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="co"># Create seamount patches - seamount areas that touch are considered the same patch</span></span>
<span><span class="va">patches_rast</span> <span class="op">&lt;-</span> <span class="fu">patchwise</span><span class="fu">::</span><span class="fu">create_patches</span><span class="op">(</span><span class="va">seamounts_rast</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/subst.html" class="external-link">subst</a></span><span class="op">(</span><span class="fl">0</span>, <span class="cn">NA</span><span class="op">)</span><span class="op">)</span> <span class="co">#patchwise currently expects all non-patches to be NA, some subsituting non-seamounts, which are currently zeroes, with NAs</span></span>
<span></span>
<span><span class="co"># Create patches dataframe - this creates several constraints so that entire seamount units are protected together</span></span>
<span><span class="va">patches_df_rast</span> <span class="op">&lt;-</span> <span class="fu">patchwise</span><span class="fu">::</span><span class="fu">create_patch_df</span><span class="op">(</span>spatial_grid <span class="op">=</span> <span class="va">pacific_hs_planning_grid</span>, features <span class="op">=</span> <span class="va">features_rast</span>, patches <span class="op">=</span> <span class="va">patches_rast</span>, costs <span class="op">=</span> <span class="va">total_annual_effort</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "Processing patch 1 of 6"</span></span>
<span><span class="co">#&gt; [1] "Processing patch 2 of 6"</span></span>
<span><span class="co">#&gt; [1] "Processing patch 3 of 6"</span></span>
<span><span class="co">#&gt; [1] "Processing patch 4 of 6"</span></span>
<span><span class="co">#&gt; [1] "Processing patch 5 of 6"</span></span>
<span><span class="co">#&gt; [1] "Processing patch 6 of 6"</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co"># Create boundary matrix for prioritizr</span></span>
<span><span class="va">boundary_matrix_rast</span> <span class="op">&lt;-</span> <span class="fu">patchwise</span><span class="fu">::</span><span class="fu">create_boundary_matrix</span><span class="op">(</span>spatial_grid <span class="op">=</span> <span class="va">pacific_hs_planning_grid</span>, patches <span class="op">=</span> <span class="va">patches_rast</span>, patch_df <span class="op">=</span> <span class="va">patches_df_rast</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Create targets for protection - let's just do 20% for each feature (including 20% of whole seamounts)</span></span>
<span><span class="va">targets_rast</span> <span class="op">&lt;-</span> <span class="fu">patchwise</span><span class="fu">::</span><span class="fu">features_targets</span><span class="op">(</span>targets <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">0.2</span>, <span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/dimensions.html" class="external-link">nlyr</a></span><span class="op">(</span><span class="va">features_rast</span><span class="op">)</span> <span class="op">+</span> <span class="fl">1</span><span class="op">)</span><span class="op">)</span>, features <span class="op">=</span> <span class="va">features_rast</span>, pre_patches <span class="op">=</span> <span class="va">seamounts_rast</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Add these targets to targets for protection for the "constraints" we introduced to protect entire seamount units</span></span>
<span><span class="va">constraints_rast</span> <span class="op">&lt;-</span> <span class="fu">patchwise</span><span class="fu">::</span><span class="fu">constraints_targets</span><span class="op">(</span>feature_targets <span class="op">=</span> <span class="va">targets_rast</span>, patch_df <span class="op">=</span> <span class="va">patches_df_rast</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run the prioritization</span></span>
<span><span class="va">problem_rast</span> <span class="op">&lt;-</span> <span class="fu">prioritizr</span><span class="fu">::</span><span class="fu">problem</span><span class="op">(</span>x <span class="op">=</span> <span class="va">patches_df_rast</span>, features <span class="op">=</span> <span class="va">constraints_rast</span><span class="op">$</span><span class="va">feature</span>, cost_column <span class="op">=</span> <span class="st">"fishing_effort"</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">prioritizr</span><span class="fu">::</span><span class="fu">add_min_set_objective</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">prioritizr</span><span class="fu">::</span><span class="fu">add_manual_targets</span><span class="op">(</span><span class="va">constraints_rast</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="fu">prioritizr</span><span class="fu">::</span><span class="fu">add_binary_decisions</span><span class="op">(</span><span class="op">)</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span></span>
<span>  <span class="co">#prioritizr::add_boundary_penalties(penalty = 0.0001, data = boundary_matrix_rast) %&gt;%</span></span>
<span>  <span class="fu">prioritizr</span><span class="fu">::</span><span class="fu">add_lpsymphony_solver</span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Solve the prioritization</span></span>
<span><span class="va">solution_rast</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/solve.html" class="external-link">solve</a></span><span class="op">(</span><span class="va">problem_rast</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Convert the prioritization into a more digestible format</span></span>
<span><span class="va">result_rast</span> <span class="op">&lt;-</span> <span class="fu">patchwise</span><span class="fu">::</span><span class="fu">convert_solution</span><span class="op">(</span>solution <span class="op">=</span> <span class="va">solution_rast</span>, patch_df <span class="op">=</span> <span class="va">patches_df_rast</span>, spatial_grid <span class="op">=</span> <span class="va">pacific_hs_planning_grid</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Show the results</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">result_rast</span>, main <span class="op">=</span> <span class="st">"Solution"</span>, </span>
<span>            col <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"grey70"</span>, <span class="st">"green4"</span><span class="op">)</span>,</span>
<span>            type <span class="op">=</span> <span class="st">"classes"</span>,</span>
<span>            levels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Not selected"</span>, <span class="st">"Selected"</span><span class="op">)</span>,</span>
<span>            fun <span class="op">=</span> <span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/lines.html" class="external-link">lines</a></span><span class="op">(</span><span class="va">pacific_hs</span> <span class="op"><a href="../reference/pipe.html">%&gt;%</a></span> <span class="fu">sf</span><span class="fu">::</span><span class="fu"><a href="https://r-spatial.github.io/sf/reference/st_transform.html" class="external-link">st_transform</a></span><span class="op">(</span><span class="va">pacific_hs_projection</span><span class="op">)</span><span class="op">)</span>, </span>
<span>            axes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>            mar <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">3</span>,<span class="fl">3</span>,<span class="fl">2</span>,<span class="fl">6</span><span class="op">)</span><span class="op">+</span><span class="fl">0.1</span><span class="op">)</span></span>
<span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/plot.html" class="external-link">plot</a></span><span class="op">(</span><span class="fu">terra</span><span class="fu">::</span><span class="fu"><a href="https://rspatial.github.io/terra/reference/as.polygons.html" class="external-link">as.polygons</a></span><span class="op">(</span><span class="va">seamounts_rast</span><span class="op">)</span>, add<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<div class="figure" style="text-align: center">
<img src="figure/prioritization_patches-1.png" alt="Prioritization solution for the Pacific High Seas area, with whole seamounts included. Black outlines are seamounts."><p class="caption">
Prioritization solution for the Pacific High Seas area, with whole
seamounts included. Black outlines are seamounts.
</p>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jason Flower.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.0.</p>
</div>

    </footer>
</div>





  </body>
</html>
